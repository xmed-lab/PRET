/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: /home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchvision/image.so: undefined symbol: _ZNK3c1010TensorImpl36is_contiguous_nondefault_policy_implENS_12MemoryFormatE
  warn(f"Failed to load image Python extension: {e}")
start feature processing ...
finish feature processing and saving!
searching ignore, param: 0
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9949, auc std: 0.0082, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching ignore, param: 0.02
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9949, auc std: 0.0082, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching ignore, param: 0.04
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9949, auc std: 0.0082, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching ignore, param: 0.06
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9941, auc std: 0.006, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching ignore, param: 0.08
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9932, auc std: 0.0061, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
params: ignore, searched threshold: 0, mean:0.9949
searching topk, param: 20
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9958, auc std: 0.0085, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching topk, param: 30
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9949, auc std: 0.0082, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching topk, param: 40
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9949, auc std: 0.0082, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching topk, param: 50
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9949, auc std: 0.0082, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching topk, param: 60
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9949, auc std: 0.0082, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
params: topk, searched threshold: 20, mean:0.9958
searching related_thresh, param: 0.86
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9949, auc std: 0.0082, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching related_thresh, param: 0.87
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9949, auc std: 0.0082, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching related_thresh, param: 0.88
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9958, auc std: 0.0085, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching related_thresh, param: 0.89
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9958, auc std: 0.0085, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching related_thresh, param: 0.9
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9958, auc std: 0.0085, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
params: related_thresh, searched threshold: 0.88, mean:0.9958
searching temperature, param: 1
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9958, auc std: 0.0085, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching temperature, param: 5
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9958, auc std: 0.0085, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching temperature, param: 10
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9958, auc std: 0.0085, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching temperature, param: 20
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9958, auc std: 0.0085, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
searching temperature, param: 30
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
auc mean: 0.9958, auc std: 0.0085, f1 mean: 0.9701, f1 std: 0.0046, acc mean: 0.9667, acc std: 0.0
params: temperature, searched threshold: 1, mean:0.9958
Namespace(mode='default', topk=20, top_instance=3000, temperature=1, related_thresh=0.88, example_num=8, multiple_num=[1, 2, 4, 8], raw_feature_path='data/ESCC/patch/features', wsi_path='data/ESCC/images', dump_features='data/ESCC/patch/collected_features', dump_pseudo='', dump_records='records/ESCC_screening_box_default.npy', vis_path='', dataset_info='data_info/ESCC.json', patch_scale=512, file_min_size=5000, c=1, seg=False, prompt_type='box', prompt_path='data/ESCC/anno', ignore=0, ignore_query=0.2, seed=1024, runs=5, val_num=100, test_num=-1, val_ratio=0.3334)
eval 1-shot:
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
class:1 val auc:1.0, test auc:0.9769, val acc: 0.9697, test f1: 0.925, test acc: 0.9091
class:1 val auc:0.9774, test auc:0.9615, val acc: 0.9091, test f1: 0.8947, test acc: 0.8788
class:1 val auc:0.9704, test auc:0.9922, val acc: 0.9091, test f1: 0.9647, test acc: 0.9545
class:1 val auc:0.9841, test auc:0.938, val acc: 0.9394, test f1: 0.8684, test acc: 0.8485
class:1 val auc:0.9841, test auc:0.9765, val acc: 0.9394, test f1: 0.95, test acc: 0.9394
auc mean: 0.969, auc std: 0.0183, f1 mean: 0.9206, f1 std: 0.0353, acc mean: 0.9061, acc std: 0.0388
eval 2-shot:
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
class:1 val auc:0.9765, test auc:0.9824, val acc: 0.9375, test f1: 0.925, test acc: 0.9091
class:1 val auc:0.9643, test auc:0.9769, val acc: 0.9062, test f1: 0.8732, test acc: 0.8636
class:1 val auc:0.9766, test auc:0.9762, val acc: 0.9062, test f1: 0.9136, test acc: 0.8939
class:1 val auc:0.9636, test auc:0.9954, val acc: 0.9062, test f1: 0.9722, test acc: 0.9697
class:1 val auc:0.9875, test auc:0.969, val acc: 0.9375, test f1: 0.9136, test acc: 0.8939
auc mean: 0.98, auc std: 0.0088, f1 mean: 0.9195, f1 std: 0.0317, acc mean: 0.9061, acc std: 0.0351
eval 4-shot:
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
class:1 val auc:0.975, test auc:0.9712, val acc: 0.9375, test f1: 0.875, test acc: 0.8438
class:1 val auc:0.9838, test auc:0.957, val acc: 0.9375, test f1: 0.8986, test acc: 0.8906
class:1 val auc:0.971, test auc:0.9883, val acc: 0.9375, test f1: 0.9429, test acc: 0.9375
class:1 val auc:0.9961, test auc:0.9446, val acc: 0.9688, test f1: 0.8919, test acc: 0.875
class:1 val auc:0.9565, test auc:0.956, val acc: 0.9375, test f1: 0.8615, test acc: 0.8594
auc mean: 0.9634, auc std: 0.015, f1 mean: 0.894, f1 std: 0.0277, acc mean: 0.8812, acc std: 0.0322
eval 8-shot:
/home/ylini/anaconda3/envs/PRET/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
class:1 val auc:0.9788, test auc:0.9646, val acc: 0.9667, test f1: 0.9032, test acc: 0.9032
class:1 val auc:1.0, test auc:0.9438, val acc: 0.9667, test f1: 0.8824, test acc: 0.871
class:1 val auc:1.0, test auc:0.9594, val acc: 0.9667, test f1: 0.8358, test acc: 0.8226
class:1 val auc:1.0, test auc:0.9348, val acc: 0.9667, test f1: 0.8767, test acc: 0.8548
class:1 val auc:1.0, test auc:0.9577, val acc: 0.9667, test f1: 0.8788, test acc: 0.871
auc mean: 0.9521, auc std: 0.011, f1 mean: 0.8754, f1 std: 0.0219, acc mean: 0.8645, acc std: 0.0262
